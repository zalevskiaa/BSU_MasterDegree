\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[english, russian]{babel}
\usepackage[margin=0.5in]{geometry}
\usepackage{paralist}
\usepackage{amsthm, amsmath, amsfonts, amssymb}
\usepackage{mathtools} % \mathclap
\usepackage{bm}
\usepackage{dsfont}
\usepackage{hyperref}
\usepackage{tabularx}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{comment}
\usepackage{xcolor, colortbl}
\usepackage{soul}
\usepackage[normalem]{ulem}
\usepackage{xifthen, xspace}

\usepackage{sectsty}
\subsectionfont{\normalsize\color{red}}

\title{Домашнее задание №3 по курсу \\ <<Математическая Статистика в Машинном Обучении>>}
\author{Школа Анализа Данных}
\date{}

\renewenvironment{itemize}[1]{\begin{compactitem}#1}{\end{compactitem}}
\renewenvironment{enumerate}[1]{\begin{compactenum}#1}{\end{compactenum}}
\renewenvironment{description}[0]{\begin{compactdesc}}{\end{compactdesc}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%    Создание новых окружений   %%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\theoremstyle{plain}
\newtheorem*{theorem*}{Теорема}
\newtheorem*{note-none}{Замечание}

\begin{document}
\input{commands}
\maketitle

\section*{Задачи}
\subsection*{Теоретический блок}
\subsubsection*{Задача 1 [1 балл]}
Пусть дана обучающая выборка $\{(\boldX, \boldy) \colon \boldX \in \RR^{n \times d}, \boldy \in \RR^{n} \}$, $n \ge d$. Предположим, что справедлива следующая модель линейной регрессии:
$$
y = \boldx^T\boldw + \eps, \quad \eps \sim \Normal(0, \sigma^2),
$$
где $\boldw$ --- истинный, но неизвестный нам вектор весов. Пусть $\hatboldw$ --- MLE-оценка вектора весов $\boldw$.

Предположим, к нам поступили тестовые данные $\boldX^* \in \RR^{m \times d}$, для которых с помощью оценки $\hatboldw$ предсказываем вектор $\boldy^*\in \RR^{m}$.
Найдите математическое ожидание и матрицу ковариаций для вектора $\boldy^*$ (при условии фиксированной матрицы дизайна $\boldX$).

\subsubsection*{Задача 2 [1 балл]}
Пусть дана выборка $(\boldX,\boldt) = \{(\boldx_i, t_i)\colon \boldx_i \in \RR^d, t_i \in \RR\}_{i = 1}^n$, ($\boldX \in \RR^{n \times d}$, $\boldt \in \RR^n$, $n \ge d$). Предположим справедливость следующей модели данных
$$
t = \boldx^T\boldw + \eps(\boldx),
$$
где $\eps(\boldx) \sim \Normal(0, \sigma(\boldx)^2)$. Найдите MLE-оценку на вектор весов $\boldw$ в данном случае.

\subsubsection*{Задача 3 [2 балла]}
Пусть дана выборка $(\boldx, \boldy) = \{(x_i,y_i)\colon x_i, y_i \in \RR\}_{i=1}^n$. Пусть данные соответствуют модели
\begin{gather*}
	y_i = \beta x_i + \eps_i,
\end{gather*}
где $\epsilon_i \sim \Normal(0, \sigma^2)$. При этом значения $\boldx$ наблюдаются с ошибкой, т.е. представлена не выборка $(\boldx, \boldy)$, а выборка $(\boldz, \boldy) = \{(z_i, y_i)\colon z_i, y_i \in \RR\}_{i = 1}^n$, где $z_i = x_i + \delta_i$, $\delta_i \sim \Normal(0, \tau^2)$. Шумы $\eps_i$ и $\delta_i$ независимы. Оценим величину $\beta$, используя стандартный метод наименьших квадратов согласно формуле
\begin{gather*}
	\hatbeta = \frac{\sum_{i=1}^n z_i y_i}{\sum_{i=1}^n z_i^2}.
\end{gather*}
Докажите, что оценка $\hatbeta$ не является состоятельной. Для этого покажите, что $\hatbeta \xrightarrow[]{\Prob} a\beta$ при $n \to \infty$. Найдите явное выражение для $a$ в предположении, что точки $\{x_i\}_{i=1}^n$ поступают из некоторого распределения $F(x)$ с конечными первыми и вторыми моментами $\Exp(X)$ и $\Exp(X^2)$. 

\subsubsection*{Задача 4 [2 балла]}
Пусть дана обучающая выборка $\{(\boldx, \boldy) \colon \boldx \in \RR^{n}, \boldy \in \RR^{n} \}$. Предположим, что справедлива следующая модель линейной регрессии:
$$
y = w_0 + w_1 x + \eps,\qquad \eps \sim \Normal(0, \sigma^2).
$$
Сконструируйте асимтотический тест Вальда для проверки гипотезы $H_0 \colon w_1 = \alpha w_0$.

\textit{Внимание. Замечание про асимптотичность тут не просто так.}

\subsubsection*{Задача 5 [2 балла]}
Рассмотрим задачу восстановления регрессии. Модель регрессии имеет вид
$$
t = \boldx^T\boldw + \eps,
$$ 
где $\eps \sim \Normal(0,\beta^{-1})$, и на веса $\boldw$ наложено априорное распределение вида $p(\boldw) = \Normal(\boldw|\boldw_0,\boldS_0)$. 
Пусть дана выборка $(\boldX, \boldt) = \{(\boldx_i, t_i)\colon \boldx_i \in \RR^d, t_i \in \RR\}_{i=1}^n$. Найдите апостериорное распределение $p(\boldw|\boldX, \boldt)$.

\subsubsection*{Задача 6 [2 балла]}
Пусть $\boldx^{n} \sim f(\cdot)$, и пусть $\hatf(\cdot) = \hatf(\cdot;\boldx^n)$ обозначает ядерную оценку плотности на основе ядра
$$
K(x) = 
\begin{cases}
	1, &x \in \lp -\frac{1}{2}, \frac{1}{2} \rp;\\
	0, &\text{в противном случае}.
\end{cases}
$$
Найдите $\Exp [\hatf(x)]$ и $\Var [\hatf(x)]$. Покажите, что если $h\to0$ и $nh\to\infty$ при $n\to\infty$, то $\estf(x) \xrightarrow{\Prob} f(x)$ при $n\to\infty$.

\textit{Примечание. В ответе может быть использована истинная плотность $f(x)$.}

\subsubsection*{Задача 7 [4 балла]}
Рассмотрим задачу непараметрической оценки плотности распределения $p(x)$ по выборке $\boldX^{(N)}$. Обозначим через $\hatp(x;\boldX^{(N)})$
оценку плотности, полученную некоторым образом по выборке $\boldX^{(N)}$. Оценка риска для $\hatp(x;\boldX^{(N)})$ имеет вид:
$$
\hatJ(h) = \Int (\hatp(x;\boldX^{(N)}))^2 dx - \frac{2}{N} \Sum_{i=1}^N \hatp(X_i;\boldX^{(N\backslash i)}),
$$
где $\hatp(\cdot;\boldx^{(N\backslash i)})$ --- оценка плотности распределения на основе выборки $\boldX^{(N\backslash i)}$, т.е. выборки без объекта $X_i$.
\begin{itemize}
	\item (Гистограммная оценка) Разобьем диапазон наблюдаемых значений $\boldX^{(N)}$ на бины ширины $h$. Пусть в итоге значения $\boldX^{(n)}$ укладываются в $M$ последовательных бинов $B_1, \dots, B_M$. Пусть $N_m$ --- количество объектов выборки, попавших в $B_m$ ($\sum_m N_m = N$). Пусть $\hatp_m$ --- доля объектов выборки, попавших в бин $B_m$:
	$$
	N_m = \Sum_{i=1}^N I\ls X_i \in B_m\rs, \quad \hatp_m = \frac{N_m}{N}.
	$$
	
	Покажите, что в случае гистограммной оценки плотности оценка риска имеет вид:
	$$
	\hatJ(h) = \frac{2}{h(N - 1)} - \frac{N + 1}{h(N - 1)}\Sum_{m=1}^M \hatp_m^2.
	$$
	
	Докажите или опровергните равенство
	$$
	\Exp[\hatJ(h)] = \Exp[J(h)].
	$$
	Если равенство не верно, то чему равно $\Delta J(h) = \Exp[\hatJ(h)] - \Exp[J(h)]$?
	\item (Ядерная оценка) Покажите, что в случае ядерной оценки плотности оценка риска имеет вид:
	$$
	\hatJ(h) \approx \frac{1}{hN^2}\Sum_{i, j} K^*\lp \frac{X_i - X_j}{h}\rp + \frac{2}{N h}K(0),
	$$
	где $K^*(x) = K^{(2)}(x) - 2K(x)$ и $K^{(2)}(z) = \int K(z - y)K(y)dy$. В частности, если $K(x)$ --- это плотность нормального распределения $\Normal(0, 1)$, т.е. гауссово ядро, то $K^{(2)}(z)$ --- плотность распределения $\Normal(0, 2)$.
	
	Докажите или опровергните равенство
	$$
	\Exp[\hatJ(h)] =  \Exp[J(h)].
	$$
	Если равенство не верно, то чему равно $\Delta J(h) = \Exp[\hatJ(h)] - \Exp[J(h)]$?
\end{itemize}

\subsubsection*{Задача 8 [3 балла]}
Рассмотрим задачу непараметрической регрессии:
$$
Y_i = f(X_i) + \eps_i, \quad i \in \lf 1, \dots, n \rf, \quad X_i \in \RR, \quad Y_i \in \RR.
$$
где $\eps_i$ и $X_i$ независимы, $\Exp\eps_i = 0$, $\Var\eps_i = \sigma^2$, выборка $\{X_i\}_{i=1}^n$ одномерная и сэмплируется из отрезка $[0,1]$. Необходимо по имеющимся данным оценить функцию регрессии $f(x) = \Exp(Y|X=x)$.

\begin{enumerate}
	\item [a)] Рассмотрим следующее семейство функций
	$$
	\Family_M = \lf f(x) = \Sum_{i=1}^M c_i I[x\in B_i], c_i \in \RR, i=\overline{1, M} \rf, \text{ где } B_i = \ls\frac{i-1}{M}, \frac{i}{M}\rp.
	$$
	Последний отрезок $B_M$ включает обе граничные точки. Найдите функцию из класса $\Family_M$, которая минимизирует сумму квадратов ошибок:
	$$
	r(x;\boldX^n) = \argmin_{f(x) \in \Family_M}\Sum_{i=1}^n\lp Y_i - f(X_i)\rp^2
	$$
	\item [b)] Найдите функцию регрессии поточечно, решив в каждой точке $x$ следующую оптимизационную задачу:
	% Формула Надарая-Ватсона
	$$
	r(x;\boldX^n) = \argmin_{y \in \RR}\Sum_{i=1}^nK\lp\frac{x-X_i}{h}\rp\lp Y_i - y\rp^2,
	$$
	где $K(x)$ --- заданная ядерная функция, $h$ --- ширина ядра.
	\item [c)] Какая оценка получится, если изменить задачу на следующую:
	$$
	r(x;\boldX^n) = \argmin_{a, b \in \RR}\Sum_{i=1}^n K\lp\frac{x-X_i}{h}\rp\lp Y_i - a - bX_i\rp^2,
	$$
	где $K(x)$ --- заданная ядерная функция, $h$ --- ширина ядра?
\end{enumerate}

\subsection*{Практический блок}

\subsubsection*{Задача 9 [2 балла]}
Винни-Пуху на день рождения Сова подарила 5 горшочков с медом, каждый приблизительно весом 1 кг (исходя из объема горшочка и плотности мёда). Однако из проверенных источников (от Пятачка), Винни-Пух получил информацию, что один горшочек предположительно содержит неправильный мёд, причем его вес должен отличаться от 1 кг (из-за содержания неправильных веществ). Для проведения следственных мероприятий у ослика Иа-Иа были изъяты самодельные весы. Взвесив каждый горшочек индивидуально, Винни-Пух обнаружил, что весы явно имеют некоторую неизвестную погрешность взвешивания, так что проделанные измерения не позволяют однозначно проверить информацию о неправильности мёда в одном из горшочков. Поэтому Винни-Пух почему-то решил взвешивать горшочки сразу по два, но как только он закончил эти 10 взвешиваний, как ослик Иа-Иа, пригрозив судебными разбирательствами, в принудительном порядке затребовал свои весы обратно, оставив Винни-Пуха с результатами 15-и взвешиваний.

Нам даны результаты этих взвешиваний --- бинарная матрица $\boldX \in \{0, 1\}^{n \times d}$, где $n = 15$ и $d = 5$, и вектор $\boldy$ с результатами взвешиваний (\texttt{honey\_X.csv} и \texttt{honey\_y.csv}). По этим данных для каждого горшочка найдите p-value для гипотезы о том, что данный горшочек содержит неправильный мёд. Если ли среди горшочков такой, который на уровне значимости 95\% содержит неправильный мёд?

\textbf{Дополнительное задание на 1 балл}. Дисперсия веса горшочка зависит от дизайна взвешиваний (выбора матрицы $\boldX$). Возможно Винни-Пух ошибся, начав взвешивать горшочки сразу по два, и вместо этого стоило взвесить каждый горшочек отдельно от других ещё по два раза, получив в результате те же самые 15 взвешиваний до того момента, как весы были возвращены Иа-Иа. Найдите отношение дисперсии оценки веса горшочка в случае дизайна, предложенного Винни-Пухом, к дисперсии оценки веса горшочка в случае предложенного <<индивидуального>> дизайна. Какой дизайн лучше с точки зрения поиска горшочка с неправильным мёдом?

\subsubsection*{Задача 10 [3 балла]}
Скачайте данные \texttt{data.csv}, содержащие 12 столбцов независимых переменных и 1 столбец с зависимой переменной. Первые 250 строк отведите под обучение, а оставшиеся 1250 под тест (да, под обучение отводим сильно меньше).

\begin{itemize}
	\item Обучите простую линейную регрессию по обучающей выборке. Примените модель к тестовой выборке и найдите MSE.
	\item По обучающей выборке оцените наилучший набор признаков, описывающих выходную переменную. Используйте для этого статистику Cp Mallow, AIC-критерий, BIC-критерий, LOO-проверку. Выбор подмножества признаков проведите полным перебором. Позволяет ли какой-нибудь набор признаков получить значение MSE на тестовых данных меньше, чем на всех признаках?
	
	\textit{Внимание. В ответе должно быть понятно, какой набор признаков был выбран согласно каждому из критериев.}
\end{itemize}

\subsubsection*{Задача 11 [4 балла]}
Скачать данные со страницы курса (значения коэффициента преломления для разных типов стекла; первый столбец). Оценить плотность распределения этих значений, используя гистограмму и ядерную оценку. Для подбора ширины ячейки или ширины ядра использовать перекрестную проверку (кросс-проверку).  Для выбранных значений ширины ячейки и ширины ядра построить 95\%-ые доверительные интервалы для полученной оценки плотности.

\subsubsection*{Задача 12 [4 балла]}
По данным из предыдущей задачи, используя в качестве выходной переменной $y$ значения преломления для разных типов стекла, а в качестве входной переменной $x$ --- данные о содержании алюминия (четвертая переменная в матрице данных), восстановить зависимость между $y$ и $x$ с помощью ядерной непараметрической регрессии. Оценку ядра проводить с помощью перекрестной проверки. Построить 95\%-ые доверительные интервалы для полученной оценки функции регрессии.

\end{document}